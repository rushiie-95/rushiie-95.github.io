<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daytrade Analyses – Data Explorer</title>
  <style>
    :root{ --bg:#0b0d10; --panel:#12161b; --muted:#98a2b3; --text:#e5e7eb; --brand:#22d3ee; --brand2:#60a5fa; --accent:#1f2937; --border:#1f2833; --chip:#111827; }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans', 'Helvetica Neue', Arial; }
    header { position: sticky; top:0; z-index: 10; background: linear-gradient(90deg, rgba(34,211,238,0.08), rgba(96,165,250,0.08)); border-bottom:1px solid var(--border); backdrop-filter: blur(8px); }
    .wrap { max-width: 1280px; margin: 0 auto; padding: 16px; }
    .row { display:flex; gap:12px; flex-wrap: wrap; align-items: center; }
    h1 { font-size: 20px; margin: 0 0 8px 0; letter-spacing:.3px; }
    .muted { color: var(--muted); }
    .card { background: var(--panel); border:1px solid var(--border); border-radius: 14px; padding: 16px; }
    .controls { display:flex; gap:12px; flex-wrap: wrap; align-items:center; }
    select, input[type="text"] { background: #0d1117; color: var(--text); border:1px solid var(--border); border-radius: 10px; padding: 10px 12px; outline: none; min-width: 180px; }
    input[type="text"] { flex: 1 1 260px; }
    .pill { background: var(--chip); border:1px solid var(--border); border-radius: 999px; padding: 6px 10px; font-size: 12px; }
    table { width: 100%; border-collapse: collapse; }
    thead th { position: sticky; top: 0; background: #0e131a; border-bottom: 1px solid var(--border); text-align: left; padding: 10px; font-weight: 600; white-space: nowrap; cursor: pointer; }
    tbody td { border-bottom: 1px dashed var(--border); padding: 10px; vertical-align: top; }
    tbody tr:hover { background: rgba(255,255,255,0.02); }
    .footer { color: var(--muted); font-size: 12px; margin-top: 12px; }
    .tabbar { display:flex; gap:8px; flex-wrap: wrap; margin: 10px 0 0 0; }
    .tabbar button { background:#0d1117; color:var(--text); border:1px solid var(--border); border-radius:999px; padding:8px 12px; cursor:pointer; }
    .tabbar button.active { border-color: var(--brand2); box-shadow: inset 0 0 0 1px var(--brand2); }
    .count { font-variant-numeric: tabular-nums; }
    .hr { height:1px; background:var(--border); margin:12px 0; }
    .scroll { overflow:auto; max-height: 72vh; border-radius: 10px; }
    .k { color:#93c5fd; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Daytrade Analyses <span class="muted">• Data Explorer</span></h1>
      <div class="row">
        <div class="pill">Built: <!-- ใส่วันที่ด้วยสคริปต์ --><span id="builtAt"></span></div>
        <div class="pill">Sheets: <span class="count" id="sheetTotal">0</span></div>
      </div>
    </div>
  </header>

  <main class="wrap" id="app">
    <div class="card">
      <div class="controls">
        <label>
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">เลือกชีต</span>
          <select id="sheetSelect"></select>
        </label>
        <label style="flex:1">
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">ค้นหา</span>
          <input id="searchInput" type="text" placeholder="พิมพ์เพื่อกรองข้อมูลในตาราง..." />
        </label>
        <div class="pill"><span id="rowCount" class="count">0</span> rows</div>
        <div class="pill"><span id="colCount" class="count">0</span> cols</div>
      </div>

      <div class="tabbar" id="quickTabs"></div>
      <div class="hr"></div>

      <div class="scroll">
        <table id="dataTable">
          <thead id="tableHead"></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      <div class="footer">Tip: คลิกหัวตารางเพื่อเรียงลำดับ · กด <strong>Shift</strong> ค้างแล้วคลิกเพื่อเรียงหลายคอลัมน์</div>
    </div>

    <div class="footer">ไฟล์นี้เป็น HTML เดียวแบบ self-contained (CSS/JS ฝังในไฟล์) นำไปวางที่ <span class="k">index.html</span> บน GitHub Pages ได้ทันที.</div>
  </main>

  <script>
    /* ========= ใส่ข้อมูลชีตของคุณตรงนี้ =========
       โครงสร้าง DATA:
       {
         "ชื่อชีต": {
            "columns": ["คอลัมน์1","คอลัมน์2",...],
            "rows": [ {"คอลัมน์1":"ค่า", "คอลัมน์2":"ค่า", ...}, ... ]
         },
         ...
       }
       หมายเหตุ: เวอร์ชันนี้เป็นแม่แบบว่าง ๆ
       หากคุณต้องการให้ผม “แปลง Excel เป็น DATA ให้ครบอัตโนมัติ” อีกครั้ง
       บอกผมได้เลย ผมจะฝัง JSON ที่แปลงจากไฟล์ล่าสุดของคุณให้ทันที
    ============================================ */
    const DATA = {
      "ชีต80": { "columns": [], "rows": [] },
      "Data Analysis": { "columns": [], "rows": [] },
      "Aim Training NEWDAY": { "columns": [], "rows": [] },
      "Traning Garph": { "columns": [], "rows": [] },
      "ชีต51": { "columns": [], "rows": [] },
      "Schedul": { "columns": [], "rows": [] },
      "บันทึกห้องซ้อม": { "columns": [], "rows": [] },
      "สรุปผล": { "columns": [], "rows": [] },
      "ชีต31": { "columns": [], "rows": [] }
    };

    // ====== หากคุณมีไฟล์ JSON แยก ให้ใช้รูปแบบนี้แทน ======
    // fetch('data.json').then(r=>r.json()).then(json => { Object.assign(DATA, json); init(); });

    const sheetSelect = document.getElementById('sheetSelect');
    const searchInput = document.getElementById('searchInput');
    const headEl = document.getElementById('tableHead');
    const bodyEl = document.getElementById('tableBody');
    const rowCount = document.getElementById('rowCount');
    const colCount = document.getElementById('colCount');
    const quickTabs = document.getElementById('quickTabs');
    const builtAt = document.getElementById('builtAt');
    const sheetTotal = document.getElementById('sheetTotal');

    const state = {
      sheet: null,
      query: '',
      sort: [] // array of [key, dir] where dir is 1 (asc) or -1 (desc)
    };

    function init() {
      // แสดงเวลา build
      const pad = n => String(n).padStart(2,'0');
      const d = new Date();
      builtAt.textContent = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;

      // เติมชื่อชีตใน selector และปุ่มทางลัด
      Object.keys(DATA).forEach((name) => {
        const opt = document.createElement('option');
        opt.value = name; opt.textContent = name;
        sheetSelect.appendChild(opt);

        const btn = document.createElement('button');
        btn.textContent = name;
        btn.addEventListener('click', () => { sheetSelect.value = name; onSheetChange(); });
        quickTabs.appendChild(btn);
      });

      sheetTotal.textContent = Object.keys(DATA).length;

      // Restore จาก hash
      const hash = new URLSearchParams(location.hash.replace('#',''));
      const sheetFromHash = hash.get('sheet');
      if (sheetFromHash && DATA[sheetFromHash]) {
        sheetSelect.value = sheetFromHash;
      } else {
        sheetSelect.selectedIndex = 0;
      }
      onSheetChange();
    }

    function onSheetChange() {
      state.sheet = sheetSelect.value;
      // Active tab
      Array.from(quickTabs.children).forEach(btn => {
        btn.classList.toggle('active', btn.textContent === state.sheet);
      });
      // Reset
      state.sort = [];
      searchInput.value = '';
      state.query = '';
      location.hash = `sheet=${encodeURIComponent(state.sheet)}`;
      render();
    }

    function normalize(s) {
      return (s==null?'':String(s)).toLowerCase();
    }

    function getFilteredRows(sheet) {
      const payload = DATA[sheet];
      if (!payload || !payload.rows) return [];
      const q = normalize(state.query);
      if (!q) return payload.rows.slice();
      const keys = payload.columns;
      return payload.rows.filter(row => keys.some(k => normalize(row[k]).includes(q)));
    }

    function multiSort(rows, sortSpec) {
      if (!sortSpec.length) return rows;
      const keys = sortSpec.map(([k,dir]) => [k, dir]);
      return rows.slice().sort((a,b) => {
        for (const [k,dir] of keys) {
          const av = normalize(a[k]);
          const bv = normalize(b[k]);
          if (av < bv) return -1*dir;
          if (av > bv) return 1*dir;
        }
        return 0;
      });
    }

    function render() {
      const sheet = state.sheet;
      const payload = DATA[sheet] || {columns:[], rows:[]};
      const cols = payload.columns || [];
      const rowsFiltered = getFilteredRows(sheet);
      const rows = multiSort(rowsFiltered, state.sort);

      // header
      headEl.innerHTML = '';
      const trHead = document.createElement('tr');
      cols.forEach(col => {
        const th = document.createElement('th');
        const sortIdx = state.sort.findIndex(([k]) => k === col);
        const dir = sortIdx >= 0 ? state.sort[sortIdx][1] : 0;
        th.innerHTML = `<span>${col}</span> ` + (dir===1?'▲':dir===-1?'▼':'');
        th.title = 'คลิกเพื่อเรียง • Shift+คลิกเรียงซ้อน';
        th.addEventListener('click', (e) => onSort(col, e.shiftKey));
        trHead.appendChild(th);
      });
      headEl.appendChild(trHead);

      // body
      bodyEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      rows.forEach(row => {
        const tr = document.createElement('tr');
        cols.forEach(col => {
          const td = document.createElement('td');
          let val = row[col];
          if (val === null || val === undefined) val = '';
          td.textContent = val;
          tr.appendChild(td);
        });
        frag.appendChild(tr);
      });
      bodyEl.appendChild(frag);

      rowCount.textContent = String(rows.length);
      colCount.textContent = String(cols.length);
    }

    function onSort(col, multi) {
      let spec = state.sort.slice();
      const existingIdx = spec.findIndex(([k]) => k === col);
      if (existingIdx >= 0) {
        const [k, dir] = spec[existingIdx];
        if (dir === 1) spec[existingIdx][1] = -1;
        else if (dir === -1) spec.splice(existingIdx, 1);
      } else {
        if (!multi) spec = []; // reset ถ้าไม่กด Shift
        spec.push([col, 1]);
      }
      state.sort = spec;
      render();
    }

    sheetSelect.addEventListener('change', onSheetChange);
    searchInput.addEventListener('input', (e) => { state.query = e.target.value; render(); });
    window.addEventListener('hashchange', () => {
      const hash = new URLSearchParams(location.hash.replace('#',''));
      const sheetFromHash = hash.get('sheet');
      if (sheetFromHash && DATA[sheetFromHash] && sheetFromHash !== state.sheet) {
        sheetSelect.value = sheetFromHash;
        onSheetChange();
      }
    });

    // เริ่มทำงาน
    init();
  </script>
</body>
</html>
