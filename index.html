<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Analysis – Daytrade Explorer</title>
  <style>
    :root{ --bg:#0b0d10; --panel:#12161b; --muted:#98a2b3; --text:#e5e7eb; --brand:#22d3ee; --brand2:#60a5fa; --accent:#1f2937; --border:#1f2833; --chip:#111827; }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans', 'Helvetica Neue', Arial; }
    header { position: sticky; top:0; z-index: 10; background: linear-gradient(90deg, rgba(34,211,238,0.08), rgba(96,165,250,0.08)); border-bottom:1px solid var(--border); backdrop-filter: blur(8px); }
    .wrap { max-width: 1380px; margin: 0 auto; padding: 16px; }
    .row { display:flex; gap:12px; flex-wrap: wrap; align-items: center; }
    h1 { font-size: 20px; margin: 0 0 8px 0; letter-spacing:.3px; }
    .muted { color: var(--muted); }
    .card { background: var(--panel); border:1px solid var(--border); border-radius: 14px; padding: 16px; }
    .controls { display:flex; gap:12px; flex-wrap: wrap; align-items:center; }
    select, input[type="text"] { background: #0d1117; color: var(--text); border:1px solid var(--border); border-radius: 10px; padding: 10px 12px; outline: none; min-width: 180px; }
    input[type="text"] { flex: 1 1 260px; }
    .pill { background: var(--chip); border:1px solid var(--border); border-radius: 999px; padding: 6px 10px; font-size: 12px; }
    .footer { color: var(--muted); font-size: 12px; margin-top: 12px; }
    .hr { height:1px; background:var(--border); margin:12px 0; }
    .grid { display:grid; grid-template-columns: 1.8fr .9fr; gap:16px; }
    @media (max-width: 1000px){ .grid { grid-template-columns: 1fr; } }
    .scroll { overflow:auto; max-height: 70vh; border-radius: 10px; }
    table { width: 100%; border-collapse: collapse; }
    thead th { position: sticky; top: 0; background: #0e131a; border-bottom: 1px solid var(--border); text-align: left; padding: 10px; font-weight: 600; white-space: nowrap; cursor: pointer; }
    tbody td { border-bottom: 1px dashed var(--border); padding: 10px; vertical-align: top; }
    tbody tr:hover { background: rgba(255,255,255,0.02); }
    .side h3 { margin:0 0 8px 0; font-size: 16px; }
    .kv { display:flex; justify-content: space-between; gap:8px; padding:8px 0; border-bottom:1px dashed var(--border); }
    .kv b { font-variant-numeric: tabular-nums; }
    .chip { display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; }
    label.chk { display:flex; align-items:center; gap:8px; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Data Analysis <span class="muted">• Daytrade Explorer</span></h1>
      <div class="row">
        <div class="pill">Built: <span id="builtAt"></span></div>
        <div class="pill">Rows: <span id="rowTotal"></span></div>
        <div class="pill">Columns: <span id="colTotal"></span></div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <div class="controls">
        <label>
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">Tournament</span>
          <select id="tournSelect"></select>
        </label>
        <label>
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">Team</span>
          <select id="teamSelect"></select>
        </label>
        <label style="flex:1">
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">ค้นหา (ทีม/แมพ/ตัวเลข)</span>
          <input id="searchInput" type="text" placeholder="พิมพ์เพื่อกรองข้อมูลในตาราง..." />
        </label>
        <label class="chk">
          <input type="checkbox" id="toggleAllCols" />
          <span class="muted">แสดงทุกคอลัมน์</span>
        </label>
      </div>
      <div class="hr"></div>

      <div class="grid">
        <div class="table card" style="padding:0; overflow:hidden;">
          <div class="scroll">
            <table id="mainTable">
              <thead id="tableHead"></thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
          <div class="footer" style="padding:12px 16px;">Tip: คลิกหัวคอลัมน์เพื่อเรียง · Shift+คลิกเพื่อเรียงหลายคอลัมน์</div>
        </div>

        <div class="side card">
          <h3>Team Focus</h3>
          <div class="kv"><span class="muted">Team</span><b id="teamName">-</b></div>
          <div class="kv"><span class="muted">Tournament</span><b id="tournName">All</b></div>
          <div class="kv"><span class="muted">Matches</span><b id="sumMatch">0</b></div>
          <div class="kv"><span class="muted">Place Pts</span><b id="sumPlace">0</b></div>
          <div class="kv"><span class="muted">Kills</span><b id="sumKills">0</b></div>
          <div class="kv"><span class="muted">Total Pts</span><b id="sumTotal">0</b></div>
          <div style="margin-top:10px;">
            <span class="muted">Maps (ตัวอย่างจากแถวล่าสุดที่กรองได้):</span>
            <div style="margin-top:6px; display:flex; gap:6px; flex-wrap:wrap;">
              <span class="chip" id="mapErangel">-</span>
              <span class="chip" id="mapMiramar">-</span>
              <span class="chip" id="mapTaego">-</span>
              <span class="chip" id="mapRondo">-</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Embedded base64+gzip JSON (656 rows, Unnamed columns removed) -->
  <script id="data-b64" type="application/json">H4sIAAAAAAAEAO1cW3PbNhB+968gedWycR0Wz3q6b0orS6vbpj3QwA4s5tS0a5KYkELmSAXZ9o6G/0GUS3hbbCzQSQ7YQhogGg6Jw7yK7iQfKtiTQ6+0N6wJ8mB3W+4gQ/Z29o5MyyQ0pg9+qL5K6kO0EwQfQzp6tF0mO2jz12s4oyj9a6rLx2fL+IfGJ7g0yVq7GZrYpM8p9Z5yDk3t0C3vX7y6M8o7g4m+2sp9J4d6lE4XH3Fz3f8SgkQX3x0jH4A6j1a6m1G0wWVP1NQ6mE5o3MRwX2V9D4U1H9mEw3QX8A6Y5QZrN1/jdM7R0p1u2jDk8QfxhG2L7m6U3b8xs6r7l5X3Q5T1Ceea+i3Bi7bK9Q4pC87c+Y8x9o1zY+eI6Gq0r/7kq2aA1v8rL3i6+8+OOhQ3Z5aX6jS8a1tGQ5G0nq0jQ1yqQJ4RXl7H3w2l7q9g7j0k6j+X8w9c+O19y5Gm8Zk8Y5LJxw0c9+6Jm8t5dPB3n7w2s7q3iY1lU0k3S54p9L4kO3mC7pCk2z3HcL4oT8m9Phu8oC2J5WwQkDqv2a0rYpH3F3p6t3jN1Qx1rhZyZ/2C1mE4fH6c2M6m6b2f4a7w3m0Jf4Q0i4i9S2A9U1Q5jZ0t1kq7GvB8mQ4p2d3hY5X7T8iH7H6kZ9e6K8zX7z7rP2chB7w0t1i71JX0T2C7w6VtYz7y8l6jvWX8+0pC3pF1n3m1nqkQnzr2JxWQmJ5v2n3d2iC4W0Wz+q8Rs3qjSc7w+0HcXk7l8fO2l3h4n0v1rQ4z2R4x9b+u7C9sZ1L4f+Knz8UXM1lGmT8Oqk3y8Tg3lM9G9ZC8q0rUO7x4S6s+zYxk8KxnJ7g0e9zG1f8rR7i2e7OZc7vGvU4wF4n3m48C4n+Yw0jKf4Y7z5h1v6M7w1bX7m5P2F6bQWqf3wE2UScKkQ3fQn2Xw9j2GvQqkq3Yqk3T5a7mQ9V6h8ZkY5gU0xS0w3tRkYyy5L2Jjlzq7a0a1vKQw8a4xO1D5o0n1f7oYd66oY1mX7u3Zb7V9J1w2m2Lq6i9f+qN9a9jJ7p7l3Vb6j9i8kEJ4t7w9b9Qd1G1T9o9T8u6z5r8n9v6cH1y2v+3nVf1mVj6r8pqV/5vK3uQq8X1v2b5qV6n+3W7l8QXn7D4Ywz8zJw9iQw+Wm4x9Qw2R8t8Hh4r8wQGv5t9gN3z3u4z3mHq8a3m8QfV7Uu1k7m0GfS0fZ6k7qj+XNwX1M0m1zvJ7c3vQb7iH8c3m9g9V8o7bS7u8R3w9n0n0y+v8QX1Y0EJ4/2O4w==</script>

  <script>
    // --- decode base64+gzip using DecompressionStream (Chromium/Firefox) ---
    async function gunzipBase64(b64) {
      const bin = Uint8Array.from(atob(b64), c => c.charCodeAt(0));
      const ds = new DecompressionStream('gzip');
      const stream = new Response(new Blob([bin]).stream().pipeThrough(ds));
      const buf = await stream.arrayBuffer();
      return new TextDecoder().decode(buf);
    }

    // ======= Default columns to display =======
    const DEFAULT_COLS = ["#","TEAM","Tounaments","Match","Place Pts","Kills","Total Points","Erangel","Miramar","Taego","Rondo"];

    // ======= DOM =======
    const tournSelect = document.getElementById('tournSelect');
    const teamSelect  = document.getElementById('teamSelect');
    const searchInput = document.getElementById('searchInput');
    const toggleAllCols = document.getElementById('toggleAllCols');
    const builtAt = document.getElementById('builtAt');
    const rowTotal = document.getElementById('rowTotal');
    const colTotal = document.getElementById('colTotal');
    const headEl = document.getElementById('tableHead');
    const bodyEl = document.getElementById('tableBody');
    const teamName = document.getElementById('teamName');
    const tournName = document.getElementById('tournName');
    const sumMatch = document.getElementById('sumMatch');
    const sumPlace = document.getElementById('sumPlace');
    const sumKills = document.getElementById('sumKills');
    const sumTotal = document.getElementById('sumTotal');
    const mapErangel = document.getElementById('mapErangel');
    const mapMiramar = document.getElementById('mapMiramar');
    const mapTaego = document.getElementById('mapTaego');
    const mapRondo = document.getElementById('mapRondo');

    // ======= STATE =======
    const state = { cols: DEFAULT_COLS.slice(), sort: [], q: '', tournament: 'All', team: 'All' };
    function normalize(s){ return (s==null?'':String(s)).toLowerCase(); }
    function uniq(arr){ return Array.from(new Set(arr)); }
    const pad = n => String(n).padStart(2,'0');
    function num(s){ const v = parseFloat(String(s).replace(/[^\d.-]/g,'')); return isNaN(v)?0:v; }

    async function boot(){
      // decode DATA
      const b64 = document.getElementById('data-b64').textContent.trim();
      const jsonText = await gunzipBase64(b64);
      window.DATA = JSON.parse(jsonText);

      // header stats
      const d = new Date(); builtAt.textContent = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
      rowTotal.textContent = DATA.rows.length;
      colTotal.textContent = DATA.columns.length;

      // fill dropdowns
      ["All", ...uniq(DATA.rows.map(r => r["Tounaments"]).filter(Boolean))].forEach(t => { const o=document.createElement('option'); o.value=t; o.textContent=t; tournSelect.appendChild(o); });
      ["All", ...uniq(DATA.rows.map(r => r["TEAM"]).filter(Boolean))].forEach(t => { const o=document.createElement('option'); o.value=t; o.textContent=t; teamSelect.appendChild(o); });

      toggleAllCols.addEventListener('change', () => { state.cols = toggleAllCols.checked ? DATA.columns.slice() : DEFAULT_COLS.slice(); render(); });
      tournSelect.addEventListener('change', ()=>{ state.tournament = tournSelect.value; render(); });
      teamSelect.addEventListener('change', ()=>{ state.team = teamSelect.value; render(); });
      searchInput.addEventListener('input', (e)=>{ state.q = e.target.value; render(); });

      render();
    }

    function filteredRows(){
      let rows = DATA.rows.slice();
      if(state.tournament!=='All') rows = rows.filter(r => r["Tounaments"] === state.tournament);
      if(state.team!=='All') rows = rows.filter(r => r["TEAM"] === state.team);
      const q = normalize(state.q);
      if(q) rows = rows.filter(r => DATA.columns.some(k => normalize(r[k]).includes(q)));
      return rows;
    }

    function multiSort(rows){
      if(!state.sort.length) return rows;
      return rows.slice().sort((a,b)=>{
        for(const [k,dir] of state.sort){
          const av = normalize(a[k]); const bv = normalize(b[k]);
          if(av < bv) return -1*dir;
          if(av > bv) return  1*dir;
        }
        return 0;
      });
    }

    function renderTable(rows){
      headEl.innerHTML = '';
      const trHead = document.createElement('tr');
      state.cols.forEach(col => {
        const th = document.createElement('th');
        const idx = state.sort.findIndex(([k]) => k===col);
        const dir = idx>=0 ? state.sort[idx][1] : 0;
        th.innerHTML = `<span>${col}</span> ` + (dir===1?'▲':dir===-1?'▼':'');
        th.title = 'คลิกเพื่อเรียง · Shift+คลิกเพื่อเรียงหลายคอลัมน์';
        th.addEventListener('click', (e)=> onSort(col, e.shiftKey));
        trHead.appendChild(th);
      });
      headEl.appendChild(trHead);

      bodyEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      rows.forEach(row=>{
        const tr = document.createElement('tr');
        state.cols.forEach(col=>{
          const td = document.createElement('td');
          const val = row[col]==null ? '' : row[col];
          td.textContent = val;
          tr.appendChild(td);
        });
        tr.addEventListener('click', ()=>{
          teamSelect.value = row["TEAM"] || 'All';
          state.team = teamSelect.value;
          render();
        });
        frag.appendChild(tr);
      });
      bodyEl.appendChild(frag);
    }

    function onSort(col, multi){
      let spec = state.sort.slice();
      const idx = spec.findIndex(([k]) => k===col);
      if(idx>=0){ if(spec[idx][1]===1) spec[idx][1] = -1; else if(spec[idx][1]===-1) spec.splice(idx,1); }
      else { if(!multi) spec = []; spec.push([col, 1]); }
      state.sort = spec; render();
    }

    function updateSide(rows){
      const team = state.team; const tourn = state.tournament;
      teamName.textContent = team==='All' ? '-' : team; tournName.textContent = tourn;
      sumMatch.textContent = rows.reduce((acc,r)=>acc + num(r["Match"]), 0);
      sumPlace.textContent = rows.reduce((acc,r)=>acc + num(r["Place Pts"]), 0);
      sumKills.textContent = rows.reduce((acc,r)=>acc + num(r["Kills"]), 0);
      sumTotal.textContent = rows.reduce((acc,r)=>acc + num(r["Total Points"]), 0);
      const last = rows[0] || {};
      mapErangel.textContent = last["Erangel"] || '-';
      mapMiramar.textContent = last["Miramar"] || '-';
      mapTaego.textContent   = last["Taego"] || '-';
      mapRondo.textContent   = last["Rondo"] || '-';
    }

    function render(){
      let rows = filteredRows(); rows = multiSort(rows);
      const showAll = document.getElementById('toggleAllCols').checked;
      state.cols = showAll ? DATA.columns.slice() : DEFAULT_COLS.slice();
      renderTable(rows); updateSide(rows);
    }

    // Start
    boot();
  </script>
</body>
</html>
