<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Analysis – Daytrade Explorer</title>
  <style>
    :root{ --bg:#0b0d10; --panel:#12161b; --muted:#98a2b3; --text:#e5e7eb; --brand:#22d3ee; --brand2:#60a5fa; --accent:#1f2937; --border:#1f2833; --chip:#111827; }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans', 'Helvetica Neue', Arial; }
    header { position: sticky; top:0; z-index: 10; background: linear-gradient(90deg, rgba(34,211,238,0.08), rgba(96,165,250,0.08)); border-bottom:1px solid var(--border); backdrop-filter: blur(8px); }
    .wrap { max-width: 1380px; margin: 0 auto; padding: 16px; }
    .row { display:flex; gap:12px; flex-wrap: wrap; align-items: center; }
    h1 { font-size: 20px; margin: 0 0 8px 0; letter-spacing:.3px; }
    .muted { color: var(--muted); }
    .card { background: var(--panel); border:1px solid var(--border); border-radius: 14px; padding: 16px; }
    .controls { display:flex; gap:12px; flex-wrap: wrap; align-items:center; }
    select, input[type="text"] { background: #0d1117; color: var(--text); border:1px solid var(--border); border-radius: 10px; padding: 10px 12px; outline: none; min-width: 180px; }
    input[type="text"] { flex: 1 1 260px; }
    .pill { background: var(--chip); border:1px solid var(--border); border-radius: 999px; padding: 6px 10px; font-size: 12px; }
    .footer { color: var(--muted); font-size: 12px; margin-top: 12px; }
    .hr { height:1px; background:var(--border); margin:12px 0; }
    .grid { display:grid; grid-template-columns: 1.8fr .9fr; gap:16px; }
    @media (max-width: 1000px){ .grid { grid-template-columns: 1fr; } }
    .scroll { overflow:auto; max-height: 70vh; border-radius: 10px; }
    table { width: 100%; border-collapse: collapse; }
    thead th { position: sticky; top: 0; background: #0e131a; border-bottom: 1px solid var(--border); text-align: left; padding: 10px; font-weight: 600; white-space: nowrap; cursor: pointer; }
    tbody td { border-bottom: 1px dashed var(--border); padding: 10px; vertical-align: top; }
    tbody tr:hover { background: rgba(255,255,255,0.02); }
    .side h3 { margin:0 0 8px 0; font-size: 16px; }
    .kv { display:flex; justify-content: space-between; gap:8px; padding:8px 0; border-bottom:1px dashed var(--border); }
    .kv b { font-variant-numeric: tabular-nums; }
    .chip { display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; }
    label.chk { display:flex; align-items:center; gap:8px; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Data Analysis <span class="muted">• Daytrade Explorer</span></h1>
      <div class="row">
        <div class="pill">Built: <span id="builtAt"></span></div>
        <div class="pill">Rows: <span id="rowTotal"></span></div>
        <div class="pill">Columns: <span id="colTotal"></span></div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <div class="controls">
        <label>
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">Tournament</span>
          <select id="tournSelect"></select>
        </label>

        <label>
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">Team</span>
          <select id="teamSelect"></select>
        </label>

        <label style="flex:1">
          <span class="muted" style="font-size:12px; display:block; margin-bottom:4px;">ค้นหา (ทีม/แมพ/ตัวเลข)</span>
          <input id="searchInput" type="text" placeholder="พิมพ์เพื่อกรองข้อมูลในตาราง..." />
        </label>

        <label class="chk">
          <input type="checkbox" id="toggleAllCols" />
          <span class="muted">แสดงทุกคอลัมน์</span>
        </label>
      </div>
      <div class="hr"></div>

      <div class="grid">
        <div class="table card" style="padding:0; overflow:hidden;">
          <div class="scroll">
            <table id="mainTable">
              <thead id="tableHead"></thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
          <div class="footer" style="padding:12px 16px;">Tip: คลิกหัวคอลัมน์เพื่อเรียง · Shift+คลิกเพื่อเรียงหลายคอลัมน์</div>
        </div>

        <div class="side card">
          <h3>Team Focus</h3>
          <div class="kv"><span class="muted">Team</span><b id="teamName">-</b></div>
          <div class="kv"><span class="muted">Tournament</span><b id="tournName">All</b></div>
          <div class="kv"><span class="muted">Matches</span><b id="sumMatch">0</b></div>
          <div class="kv"><span class="muted">Place Pts</span><b id="sumPlace">0</b></div>
          <div class="kv"><span class="muted">Kills</span><b id="sumKills">0</b></div>
          <div class="kv"><span class="muted">Total Pts</span><b id="sumTotal">0</b></div>
          <div style="margin-top:10px;">
            <span class="muted">Maps (ตัวอย่างจากแถวล่าสุดที่กรองได้):</span>
            <div style="margin-top:6px; display:flex; gap:6px; flex-wrap:wrap;">
              <span class="chip" id="mapErangel">-</span>
              <span class="chip" id="mapMiramar">-</span>
              <span class="chip" id="mapTaego">-</span>
              <span class="chip" id="mapRondo">-</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <script>
    // ======= ข้อมูลจริงจากชีต "Data Analysis" (เฉพาะคอลัมน์ที่มีข้อมูล) =======
    // หมายเหตุ: เพื่อลดขนาดไฟล์ จึงตัดคอลัมน์ว่างออก แต่คง "คอลัมน์ที่มีข้อมูลจริง" ไว้ทั้งหมด
    const DATA = {"columns":["Lookup","TEAM","Tounaments","#","Match","Place Pts","Kills","Total Points","Erangel","Miramar","Taego","Rondo","Select Team","Unnamed: 13","#.1","TEAM.1","Tounaments.1","Rank","Match.1","Place Pts.1","Kills.1","Total Points.1","Erangel.1","Miramar.1","Taego.1","Rondo.1","Unnamed: 27","Unnamed: 28","Unnamed: 29","Unnamed: 30","Unnamed: 43"],"rows":[{"Lookup":"Twisted Minds_1","TEAM":"Twisted Minds","Tounaments":"PGS 3 A VS B","#":"1","Match":"6","Place Pts":"20","Kills":"38","Total Points":"58","Erangel":"Apartment","Miramar":"Power Grid","Taego":"-","Rondo":"-","Select Team":"Newhappy","Unnamed: 13":"","#.1":"5","TEAM.1":"Twisted Minds","Tounaments.1":"PGS 3 A VS B","Rank":"5","Match.1":"6","Place Pts.1":"12","Kills.1":"27","Total Points.1":"39","Erangel.1":"Ferry Pier","Miramar.1":"Los Leones","Taego.1":"Yong Cheon","Rondo.1":"-","Unnamed: 27":"","Unnamed: 28":"","Unnamed: 29":"","Unnamed: 30":"","Unnamed: 43":""},
{"Lookup":"Gen.G_1","TEAM":"Gen.G","Tounaments":"PGS 3 A VS B","#":"2","Match":"6","Place Pts":"24","Kills":"29","Total Points":"53","Erangel":"Pochinki","Miramar":"Monte Nuevo","Taego":"-","Rondo":"-","Select Team":"","Unnamed: 13":"","#.1":"","TEAM.1":"","Tounaments.1":"Tounaments","Rank":"Rank","Match.1":"Match","Place Pts.1":"Place Pts","Kills.1":"Kills","Total Points.1":"Total Points","Erangel.1":"Erangel","Miramar.1":"Miramar","Taego.1":"Taego","Rondo.1":"Rondo","Unnamed: 27":"","Unnamed: 28":"","Unnamed: 29":"","Unnamed: 30":"","Unnamed: 43":""},
{"Lookup":"Soniqs_1","TEAM":"Soniqs","Tounaments":"PGS 3 A VS B","#":"3","Match":"6","Place Pts":"18","Kills":"29","Total Points":"47","Erangel":"Gatka","Miramar":"Pecado","Taego":"-","Rondo":"-","Select Team":"","Unnamed: 13":"","#.1":"","TEAM.1":"","Tounaments.1":"","Rank":"","Match.1":"","Place Pts.1":"","Kills.1":"","Total Points.1":"","Erangel.1":"","Miramar.1":"","Taego.1":"","Rondo.1":"","Unnamed: 27":"","Unnamed: 28":"","Unnamed: 29":"","Unnamed: 30":"","Unnamed: 43":""},
/* …… ตัดเพื่อย่อความยาวในตัวอย่างแสดงผล ……
   โค้ดจริงของคุณควรคง rows ทั้งหมด 656 แถวไว้ครบตามไฟล์
   ให้คัดลอก DATA จริงที่ผมให้ไว้ในแชทนี้ทั้งก้อนลงไปแทนบล็อกตัวอย่างนี้
*/
]};

    // ======= ตั้งค่าคอลัมน์ที่จะโชว์เป็นค่าเริ่มต้น (โหมดปกติ) =======
    const DEFAULT_COLS = ["#","TEAM","Tounaments","Match","Place Pts","Kills","Total Points","Erangel","Miramar","Taego","Rondo"];

    // ======= DOM =======
    const tournSelect = document.getElementById('tournSelect');
    const teamSelect  = document.getElementById('teamSelect');
    const searchInput = document.getElementById('searchInput');
    const toggleAllCols = document.getElementById('toggleAllCols');
    const builtAt = document.getElementById('builtAt');
    const rowTotal = document.getElementById('rowTotal');
    const colTotal = document.getElementById('colTotal');

    const headEl = document.getElementById('tableHead');
    const bodyEl = document.getElementById('tableBody');

    const teamName = document.getElementById('teamName');
    const tournName = document.getElementById('tournName');
    const sumMatch = document.getElementById('sumMatch');
    const sumPlace = document.getElementById('sumPlace');
    const sumKills = document.getElementById('sumKills');
    const sumTotal = document.getElementById('sumTotal');
    const mapErangel = document.getElementById('mapErangel');
    const mapMiramar = document.getElementById('mapMiramar');
    const mapTaego = document.getElementById('mapTaego');
    const mapRondo = document.getElementById('mapRondo');

    // ======= STATE =======
    const state = {
      cols: DEFAULT_COLS.slice(),
      sort: [], // [ [key, dir], ... ]
      q: '',
      tournament: 'All',
      team: 'All'
    };

    // ======= Helpers =======
    const pad = n => String(n).padStart(2,'0');
    function normalize(s){ return (s==null?'':String(s)).toLowerCase(); }
    function uniq(arr){ return Array.from(new Set(arr)); }
    function by(arr, key){ return arr.map(r => r[key]); }
    function num(s){ const v = parseFloat(String(s).replace(/[^\d.-]/g,'')); return isNaN(v)?0:v; }

    function init(){
      // built time
      const d = new Date(); builtAt.textContent = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
      rowTotal.textContent = DATA.rows.length;
      colTotal.textContent = DATA.columns.length;

      // fill dropdowns
      const tourns = ["All"].concat(uniq(DATA.rows.map(r => r["Tounaments"]).filter(Boolean)));
      tourns.forEach(t => { const o=document.createElement('option'); o.value=t; o.textContent=t; tournSelect.appendChild(o); });

      const teams = ["All"].concat(uniq(DATA.rows.map(r => r["TEAM"]).filter(Boolean)));
      teams.forEach(t => { const o=document.createElement('option'); o.value=t; o.textContent=t; teamSelect.appendChild(o); });

      toggleAllCols.addEventListener('change', () => {
        state.cols = toggleAllCols.checked ? DATA.columns.slice() : DEFAULT_COLS.slice();
        render();
      });

      tournSelect.addEventListener('change', ()=>{ state.tournament = tournSelect.value; render(); });
      teamSelect.addEventListener('change', ()=>{ state.team = teamSelect.value; render(); });
      searchInput.addEventListener('input', (e)=>{ state.q = e.target.value; render(); });

      render();
    }

    function filteredRows(){
      let rows = DATA.rows.slice();

      if(state.tournament!=='All'){
        rows = rows.filter(r => r["Tounaments"] === state.tournament);
      }
      if(state.team!=='All'){
        rows = rows.filter(r => r["TEAM"] === state.team);
      }
      const q = normalize(state.q);
      if(q){
        rows = rows.filter(r => DATA.columns.some(k => normalize(r[k]).includes(q)));
      }
      return rows;
    }

    function multiSort(rows){
      if(!state.sort.length) return rows;
      const spec = state.sort.slice();
      return rows.slice().sort((a,b)=>{
        for(const [k,dir] of spec){
          const av = normalize(a[k]);
          const bv = normalize(b[k]);
          if(av < bv) return -1*dir;
          if(av > bv) return  1*dir;
        }
        return 0;
      });
    }

    function renderTable(rows){
      // header
      headEl.innerHTML = '';
      const trHead = document.createElement('tr');
      state.cols.forEach(col => {
        const th = document.createElement('th');
        const idx = state.sort.findIndex(([k]) => k===col);
        const dir = idx>=0 ? state.sort[idx][1] : 0;
        th.innerHTML = `<span>${col}</span> ` + (dir===1?'▲':dir===-1?'▼':'');
        th.title = 'คลิกเพื่อเรียง · Shift+คลิกเพื่อเรียงหลายคอลัมน์';
        th.addEventListener('click', (e)=> onSort(col, e.shiftKey));
        trHead.appendChild(th);
      });
      headEl.appendChild(trHead);

      // body
      bodyEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      rows.forEach(row=>{
        const tr = document.createElement('tr');
        state.cols.forEach(col=>{
          const td = document.createElement('td');
          const val = row[col]==null ? '' : row[col];
          td.textContent = val;
          tr.appendChild(td);
        });
        tr.addEventListener('click', ()=>{
          // set team on row click
          teamSelect.value = row["TEAM"] || 'All';
          state.team = teamSelect.value;
          render();
        });
        frag.appendChild(tr);
      });
      bodyEl.appendChild(frag);
    }

    function onSort(col, multi){
      let spec = state.sort.slice();
      const idx = spec.findIndex(([k]) => k===col);
      if(idx>=0){
        if(spec[idx][1]===1) spec[idx][1] = -1;
        else if(spec[idx][1]===-1) spec.splice(idx,1);
      }else{
        if(!multi) spec = [];
        spec.push([col, 1]);
      }
      state.sort = spec;
      render();
    }

    function updateSide(rows){
      const team = state.team;
      const tourn = state.tournament;
      teamName.textContent = team==='All' ? '-' : team;
      tournName.textContent = tourn;

      // รวมค่าเฉพาะแถวที่มีตัวเลข
      const m = rows.reduce((acc,r)=>acc + num(r["Match"]), 0);
      const p = rows.reduce((acc,r)=>acc + num(r["Place Pts"]), 0);
      const k = rows.reduce((acc,r)=>acc + num(r["Kills"]), 0);
      const t = rows.reduce((acc,r)=>acc + num(r["Total Points"]), 0);

      sumMatch.textContent = m;
      sumPlace.textContent = p;
      sumKills.textContent = k;
      sumTotal.textContent = t;

      // ตัวอย่างแผนที่จากรายการล่าสุดในผลลัพธ์ (เลียนแบบดูค่าบนชีต)
      const last = rows[0] || {};
      mapErangel.textContent = last["Erangel"] || '-';
      mapMiramar.textContent = last["Miramar"] || '-';
      mapTaego.textContent   = last["Taego"] || '-';
      mapRondo.textContent   = last["Rondo"] || '-';
    }

    function render(){
      let rows = filteredRows();
      rows = multiSort(rows);
      renderTable(rows);
      updateSide(rows);
    }

    // เริ่มทำงาน
    init();
  </script>
</body>
</html>
